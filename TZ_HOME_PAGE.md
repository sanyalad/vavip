# Техническое задание: Главная страница с анимацией перелистывания видеосекций

## Общее описание

Создание упрощенной главной страницы, которая содержит только:
- Систему перелистывания видеосекций с GSAP анимациями
- Футер с кастомным скроллом

Без дополнительных элементов (хэдер, навигация и т.д.).

## Архитектура компонента

### Структура компонента

```
HomePage (упрощенная версия)
├── VideoSectionsWrapper
│   ├── VideoSection[] (массив секций)
│   └── GSAP переходы между секциями
└── Footer
    └── Кастомный скролл
```

## Функциональные требования

### 1. Система перелистывания видеосекций

#### 1.1. Базовые возможности
- **Входные данные**: Массив видеосекций (видео, заголовок, ссылка)
- **Управление**: Переходы между секциями через жесты (wheel, touch, trackpad)
- **Анимация**: Плавные GSAP переходы между секциями
- **Направления**: Next (вниз) и Prev (вверх)

#### 1.2. Поддерживаемые жесты
- **Mouse wheel**: Переход на следующую/предыдущую секцию
- **Trackpad swipe**: Плавное перелистывание с физикой
- **Touch swipe**: Свайпы вверх/вниз для навигации

#### 1.3. Анимация переходов
- **Next (вниз)**: Новая секция въезжает снизу вверх
- **Prev (вверх)**: Новая секция въезжает сверху вниз
- **Длительность**: ~450ms
- **Easing**: `cubic-bezier(0.25, 0.1, 0.25, 1)`
- **GPU ускорение**: Использование `transform3d` и `force3D: true`

#### 1.4. Состояния секций
- **Active**: Текущая видимая секция
- **Next**: Следующая секция (показывается во время жеста)
- **Prev**: Предыдущая секция (показывается во время жеста)
- **Idle**: Неактивные секции (скрыты)

### 2. Футер с кастомным скроллом

#### 2.1. Поведение
- **Открытие**: На последней секции, при скролле вниз открывается футер
- **Высота**: ~40% от viewport height
- **Анимация**: Плавное появление снизу с GSAP
- **Скролл**: Кастомный скролл внутри футера (не влияет на основную навигацию)

#### 2.2. Интеграция с основной навигацией
- При открытом футере, wheel события прокручивают футер
- При достижении верха футера, дальнейший скролл вверх закрывает футер
- Футер не блокирует обратную навигацию по секциям

## Технические требования

### Компоненты

#### 1. HomePage (упрощенная версия)

**Расположение**: `frontend/src/pages/Home/SimpleHomePage.tsx` (или переименовать существующий)

**Используемые хуки**:
- `useGSAPSectionTransition` - управление GSAP переходами между секциями
- `useBorkLikeScroll` - обработка wheel/trackpad жестов
- `useGesturePhysics` - физика жестов для trackpad
- `useGSAPFooterDrawer` - управление футером

**Состояние**:
- `activeIndex` - индекс текущей активной секции
- `isAnimating` - флаг активной анимации перехода
- `isGesturing` - флаг активного жеста
- `direction` - направление жеста ('next' | 'prev' | null)

#### 2. VideoSection

**Расположение**: `frontend/src/components/animations/VideoSection.tsx` (использовать существующий)

**Props**:
- `index` - индекс секции
- `videoSrc` - путь к видео
- `title` - заголовок секции
- `link` - ссылка на страницу
- `isActive` - флаг активной секции
- `data-state` - состояние секции (active/next/prev/idle)

#### 3. Footer

**Расположение**: `frontend/src/components/layout/Footer.tsx` (использовать существующий или упрощенную версию)

**Особенности**:
- Интеграция с `useGSAPFooterDrawer`
- Кастомный скролл контента внутри футера
- Закрытие при скролле вверх

### Стилизация

#### CSS переменные
- `--gesture-progress` - прогресс жеста (0..1)
- `--header-h` - НЕ используется (нет хэдера)

#### Data атрибуты для управления стилями
- `data-gesture="true|false"` - активен ли жест
- `data-direction="next|prev|idle"` - направление жеста
- `data-transitioning="true|false"` - активна ли GSAP анимация
- `data-state="active|next|prev|idle"` - состояние секции

#### CSS классы (VideoSection.module.css)
- `.videoSection` - базовые стили
- `.videoSection.active` - активная секция
- `[data-gesture="true"]` - стили во время жеста
- `[data-transitioning="true"]` - стили во время GSAP анимации

### Логика перехода между секциями

#### Алгоритм работы scrollToIndex

```
1. Проверка на возможность перехода:
   - Блокировать если уже идет анимация (кроме commit состояния)
   - Проверить границы (не выходить за пределы массива)
   - Проверить направление (next/prev)

2. Подготовка к анимации:
   - Установить locks (isCommitting, isAnimating)
   - Остановить активные таймеры/анимации
   - Обновить React state (activeIndex, incomingIndex, direction)
   - Синхронизировать DOM атрибуты (data-gesture, data-direction)

3. Запуск GSAP анимации:
   - Очистить inline transforms от жестов
   - Установить начальные позиции секций
   - Создать GSAP timeline
   - Анимировать переход

4. Завершение:
   - Очистить состояние
   - Сбросить locks
   - Обновить postCommitIgnoreUntil для trackpad inertia
```

### Обработка жестов

#### Wheel/Trackpad
- Использовать `useBorkLikeScroll` для базовой обработки
- Использовать `useGesturePhysics` для trackpad с физикой
- Определение источника: trackpad vs mouse wheel

#### Touch
- Обработка touchstart, touchmove, touchend
- Расчет расстояния свайпа и скорости
- Определение направления (next/prev)

### Особые случаи

#### Последняя секция
- При попытке перехода вниз на последней секции открывается футер
- Футер открывается только если секция была достигнута (lastSlideArrivedAt)

#### Первая секция
- При попытке перехода вверх на первой секции - блокировать

#### Reduced Motion
- Если `prefers-reduced-motion`, пропускать анимации
- Мгновенные переходы без GSAP

## Данные

### Структура видеосекций

```typescript
interface VideoSection {
  id: string
  title: string
  videoSrc: string
  posterSrc?: string
  link: string
}
```

### Конфигурация

```typescript
const SECTION_CONFIG = {
  transitionDuration: 0.45, // секунды
  easing: 'cubic-bezier(0.25, 0.1, 0.25, 1)',
  snapThreshold: 0.35, // прогресс для commit
  footerHeight: 40, // процент от viewport height
}
```

## API методов компонента

### Внутренние методы

- `scrollToIndex(nextIndex, skipAnimation)` - переход на секцию по индексу
- `handleWheel(event)` - обработка wheel событий
- `handleTouchStart/Move/End(event)` - обработка touch событий
- `finalizeGesture()` - завершение жеста (commit или rollback)
- `resetGesture()` - сброс состояния жеста

## Упрощения по сравнению с текущей версией

### Удаляется
- Хэдер и связанная логика
- Навигация между страницами (роутинг остается, но UI упрощен)
- Сложные state машины (если можно упростить)
- Debug режим (опционально можно оставить)
- Логирование для отладки

### Сохраняется
- Основная логика перелистывания
- GSAP анимации
- Обработка жестов
- Футер с кастомным скроллом
- Базовая структура VideoSection

## Файловая структура

```
frontend/src/pages/Home/
├── SimpleHomePage.tsx (новая упрощенная версия)
├── Home.module.css (стили wrapper)
└── (или переименовать существующий index.tsx)

frontend/src/components/animations/
└── VideoSection.tsx (используется как есть)

frontend/src/components/layout/
└── Footer.tsx (используется или упрощенная версия)

frontend/src/hooks/
├── useGSAPSectionTransition.ts (используется)
├── useBorkLikeScroll.ts (используется)
├── useGesturePhysics.ts (используется)
└── useGSAPFooterDrawer.ts (используется)
```

## Порядок реализации

1. Создать упрощенный компонент `SimpleHomePage.tsx`
2. Удалить/закомментировать логику хэдера
3. Упростить структуру JSX (убрать хэдер, оставить только секции и футер)
4. Сохранить всю логику перелистывания и жестов
5. Протестировать на разных устройствах (trackpad, mouse, touch)
6. Убедиться, что футер работает корректно с кастомным скроллом

## Критерии готовности

- [ ] Перелистывание работает плавно на trackpad
- [ ] Перелистывание работает на mouse wheel
- [ ] Touch жесты работают корректно
- [ ] Футер открывается/закрывается плавно
- [ ] Кастомный скролл в футере работает
- [ ] Нет конфликтов между скроллом футера и навигацией по секциям
- [ ] Reduced motion поддерживается
- [ ] Нет визуальных глитчей или конфликтов стилей
- [ ] Производительность: 60fps во время анимаций

